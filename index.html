<!DOCTYPE html>
<html lang="ru">
<head><meta charset="UTF-8" /><title>Index</title><script src="https://cdn.tailwindcss.com"></script></head>
<body class="bg-white text-black font-sans">

<header class="flex justify-center items-center p-6 border-b bg-white">
  <nav class="space-x-8 text-lg font-medium">
    <a href="index.html"  class="hover:underline text-green-600 font-bold">–ì–ª–∞–≤–Ω–∞—è</a>
    <a href="registry.html"  class="hover:underline ">–†–µ–µ—Å—Ç—Ä</a>
    <a href="create.html" class="hover:underline">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</a>
    <a href="transfer.html" class="hover:underline">–ü–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ</a>
    <a href="log.html" class="hover:underline">–ñ—É—Ä–Ω–∞–ª</a>
    <a href="history.html" class="hover:underline">–ò—Å—Ç–æ—Ä–∏—è</a>
  </nav>
</header>

<main class="max-w-4xl mx-auto px-4 py-8">

<h1 class="text-4xl font-bold mb-6">–†–µ–µ—Å—Ç—Ä —É–≥–ª–µ—Ä–æ–¥–Ω—ã—Ö –µ–¥–∏–Ω–∏—Ü</h1>
<p class="text-gray-600 mb-4">–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –µ–¥–∏–Ω—É—é —Å–∏—Å—Ç–µ–º—É —É—á—ë—Ç–∞ –∏ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è —É–≥–ª–µ—Ä–æ–¥–Ω—ã—Ö –µ–¥–∏–Ω–∏—Ü</p>
<div class="grid md:grid-cols-3 gap-6 text-center">
  <a href="registry.html" class="bg-gray-50 rounded-lg p-6 shadow hover:shadow-md transition block">
    <div class="text-3xl mb-2">üìã</div><div class="font-bold">–†–µ–µ—Å—Ç—Ä</div>
    <p class="text-sm text-gray-500">–í—Å–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∫–æ–º–ø–∞–Ω–∏–∏</p>
  </a>
  <a href="create.html" class="bg-gray-50 rounded-lg p-6 shadow hover:shadow-md transition block">
    <div class="text-3xl mb-2">‚ûï</div><div class="font-bold">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</div>
    <p class="text-sm text-gray-500">–°–æ–∑–¥–∞–Ω–∏–µ –∫–æ–º–ø–∞–Ω–∏–π</p>
  </a>
  <a href="issue.html" class="bg-gray-50 rounded-lg p-6 shadow hover:shadow-md transition block">
    <div class="text-3xl mb-2">üå±</div><div class="font-bold">–í—ã–ø—É—Å–∫</div>
    <p class="text-sm text-gray-500">–î–æ–±–∞–≤–ª–µ–Ω–∏–µ —É–≥–ª–µ—Ä–æ–¥–Ω—ã—Ö –µ–¥–∏–Ω–∏—Ü</p>
  </a>
</div>

</main>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
  import { getDatabase, ref, push, onValue, update } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-database.js";

  const firebaseConfig = {
    apiKey: "AIzaSyCfCnM8w7DZKZN3dXZgDHUo9RSx1K2y6mo",
    authDomain: "carbonunitsregistry.firebaseapp.com",
    databaseURL: "https://carbonunitsregistry-default-rtdb.europe-west1.firebasedatabase.app",
    projectId: "carbonunitsregistry",
    storageBucket: "carbonunitsregistry.firebasestorage.app",
    messagingSenderId: "1096076583239",
    appId: "1:1096076583239:web:9a3b9425c66b927981ec62",
    measurementId: "G-EJCZMFZQ0G"
  };

  const app = initializeApp(firebaseConfig);
  const db = getDatabase(app);
  const path = window.location.pathname;

  if (path.includes("create.html")) {
    document.getElementById('createCompanyBtn').addEventListener('click', () => {
      const name = document.getElementById('companyName').value.trim();
      const id = document.getElementById('companyID').value.trim();
      if (!name || !id) return;
      push(ref(db, 'companies'), { name, id });
      push(ref(db, 'history'), { action: `–°–æ–∑–¥–∞–Ω–∞ –∫–æ–º–ø–∞–Ω–∏—è ${name} (ID: ${id})`, timestamp: new Date().toISOString() });
    });
    const out = document.getElementById('companyList');
    onValue(ref(db, 'companies'), snap => {
      out.innerHTML = '';
      snap.forEach(c => {
        const d = c.val();
        const el = document.createElement('li');
        el.textContent = `${d.name} (${d.id})`;
        el.className = "border p-2 rounded";
        out.appendChild(el);
      });
    });
  }

  if (path.includes("registry.html")) {
    const out = document.getElementById('companyList');
    onValue(ref(db, 'companies'), snap => {
      out.innerHTML = '';
      snap.forEach(c => {
        const d = c.val();
        const el = document.createElement('li');
        el.textContent = `${d.name} (${d.id})`;
        el.className = "border p-2 rounded";
        out.appendChild(el);
      });
    });
  }

  if (path.includes("transfer.html")) {
    document.getElementById('transferBtn').addEventListener('click', () => {
      const from = document.getElementById('from').value;
      const to = document.getElementById('to').value;
      const qty = parseInt(document.getElementById('qty').value);
      const unitsRef = ref(db, 'units');
      let count = 0;
      onValue(unitsRef, snap => {
        const updates = {};
        snap.forEach(child => {
          const d = child.val();
          if (d.currentOwner === from && count < qty) {
            updates[child.key + '/currentOwner'] = to;
            push(ref(db, 'history'), { action: `–ü–µ—Ä–µ–≤–µ–¥–µ–Ω–∞ –µ–¥–∏–Ω–∏—Ü–∞ ${d.id} –æ—Ç ${from} –∫ ${to}`, timestamp: new Date().toISOString() });
            count++;
          }
        });
        update(unitsRef, updates);
      }, { onlyOnce: true });
    });
  }

  if (path.includes("log.html")) {
    const out = document.getElementById('logTable');
    onValue(ref(db, 'units'), snap => {
      out.innerHTML = '';
      let i = 1;
      snap.forEach(child => {
        const u = child.val();
        out.innerHTML += `<tr class="border-b"><td class="p-2">${i++}</td><td class="p-2">${u.id}</td><td class="p-2">${u.issuedDate}</td><td class="p-2">${u.firstOwner}</td><td class="p-2">${u.currentOwner}</td><td class="p-2">${u.expiryYear || '-'}</td></tr>`;
      });
    });
  }

  if (path.includes("issue.html")) {
    document.getElementById('issueUnitsBtn').addEventListener('click', () => {
      const companyID = document.getElementById('targetCompany').value;
      const quantity = parseInt(document.getElementById('quantity').value);
      const type = document.getElementById('unitType').value;
      const expiryYear = document.getElementById('expiryYear').value;
      const dateStr = new Date().toISOString().split('T')[0];
      for (let i = 0; i < quantity; i++) {
        const id = `${type}-${dateStr.replaceAll('-', '')}-${Date.now() + i}`;
        const unit = {
          id,
          issuedDate: dateStr,
          firstOwner: companyID,
          currentOwner: companyID,
          expiryYear
        };
        push(ref(db, 'units'), unit);
        push(ref(db, 'history'), { action: `–í—ã–ø—É—â–µ–Ω–∞ –µ–¥–∏–Ω–∏—Ü–∞ ${id} –¥–ª—è –∫–æ–º–ø–∞–Ω–∏–∏ ${companyID}`, timestamp: new Date().toISOString() });
      }
    });
  }

  if (path.includes("history.html")) {
    const list = document.getElementById('historyList');
    onValue(ref(db, 'history'), snap => {
      list.innerHTML = '';
      snap.forEach(c => {
        const d = c.val();
        const li = document.createElement('li');
        li.className = "border-b p-1 text-sm";
        li.textContent = `${new Date(d.timestamp).toLocaleString()} ‚Äî ${d.action}`;
        list.appendChild(li);
      });
    });
  }
</script>

</body>
</html>